#!/bin/sh
#
# aptgrade is meant to perform all routine package maintenance
# (in distros that use apt, of course).

if ! command -v 'apt' >/dev/null; then
        printf "Error: command 'apt' is not available.\n" 1>&2
        exit 1
fi

indent8spaces() {
        sed -e 's/^/        /g'
}

dir="${XDG_DATA_HOME}/aptgrade"
if ! test -d "$dir"; then
        mkdir "$dir"
fi
file="${dir}/last-run.txt"

date -u +"%Y-%m-%dT%H:%M:%SZ" >"$file"
printf "\n" >>"$file"

echo 'sudo apt update
apt list --upgradable
sudo apt upgrade -y
sudo apt autoremove -y' | while read -r line
do
        printf "%s\n" "$line" | tee -a "$file"
        $line 2>/dev/null | tee -a "$file"
done
